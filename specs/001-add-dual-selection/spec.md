# Feature Specification: Dual Finalist Selection Modes

**Feature Branch**: `[001-add-dual-selection]`  
**Created**: 2025-10-28  
**Status**: Draft  
**Input**: User description: "현재 구현상태는 유지한다. 게임 시작 방법이 승자 뽑기, 패자 뽑기 인데, 여기에 승자 2명 뽑기, 패자 2명 뽑기를 추가한다. 라운드에서 승자/패자를 제외하는 것은 동일하지만, 게임의 종료조건이 조금 달라서, 최종 1인이 아닌 최종 2인이 남았을 때 종료되는 모드이다."

## Clarifications

### Session 2025-10-28

- Q: How should dual-finalist modes resolve cases where a round leaves more than two tied survivors? → A: Re-run sudden-death rounds only between the tied survivors until exactly two remain.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Identify the top two winners (Priority: P1)

대회 진행자는 8명의 참가자를 등록한 뒤 `승자 2명 뽑기` 모드를 선택해 자동 시뮬레이션을 돌리고, 최종 두 명의 우승자가 동시에 발표되기를 원한다.

**Why this priority**: 새로운 모드의 핵심 가치가 두 명의 우승자를 빠르게 확보하는 것이므로, 기본 플로우가 안정적이어야 전체 기능이 성립한다.

**Independent Test**: Launch `index.html`, 6~10명의 이름을 입력하고 `승자 2명 뽑기` 버튼을 눌러 라운드를 끝까지 진행한 뒤 UI와 한국어 콘솔 로그가 두 명의 최종 우승자를 동일하게 가리키는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 참가자 수가 4명 이상이고 `승자 2명 뽑기` 버튼이 활성화된 상태, **When** 사용자가 해당 버튼을 클릭하면, **Then** 라운드 결과로 두 명의 승자가 동시에 결정되면 즉시 종료하고, 단 한 명만 결정될 경우 해당 참가자를 “승자: {이름}”으로 명시한 뒤 서든데스 팝업을 3초간 띄우고 서든데스 모드를 이어간다.
2. **Given** 게임이 `승자 2명 뽑기` 모드에서 종료되었을 때, **When** 최종 단계에서 팝업과 콘솔 요약이 표시되면, **Then** 일반 라운드에서 확정된 승자와 서든데스에서 확정된 승자를 합쳐 두 명으로 표기하고 추가 라운드를 더는 시작하지 않는다.

---

### User Story 2 - Surface the bottom two losers (Priority: P2)

교육 담당자는 성과가 낮은 두 명을 가려내기 위해 `패자 2명 뽑기` 모드를 실행하고, 라운드마다 패자만 잔류하도록 하여 마지막에 두 명의 최종 패자를 받는다.

**Why this priority**: 패자 추적 워크플로우도 동일하게 지원되어야 조직 운영자가 원하는 페널티 대상 선정을 빠르게 수행할 수 있다.

**Independent Test**: Manual browser run with 6명 이상의 참가자를 입력한 뒤 `패자 2명 뽑기`를 눌러 전체 라운드를 관찰하고, 마지막에 남은 두 명이 UI/콘솔에서 패자라고 명시되는지 검증한다.

**Acceptance Scenarios**:

1. **Given** 게임이 `패자 2명 뽑기` 모드에서 진행 중이고 라운드가 종료되었다면, **When** 패자 목록이 갱신되면, **Then** 패자만 게임 패널에 남고 승자는 대기열로 이동하며 두 명이 동시에 패자로 확정되면 즉시 종료하고, 단 한 명만 결정될 경우 해당 참가자를 “패자: {이름}”으로 명시한 뒤 서든데스 팝업을 3초간 보여주고 서든데스를 이어간다.
2. **Given** 최종 종료 시점, **When** 시스템이 결과를 알릴 때, **Then** 일반 라운드에서 확정된 패자와 서든데스에서 확정된 패자를 합쳐 두 명을 팝업·콘솔에 동일한 순서로 표기하고 재시작 버튼만 활성화한다.

---

### User Story 3 - Maintain mode clarity across selections (Priority: P3)

운영자는 같은 세션에서 단일 최종자 모드와 2인 최종자 모드를 번갈아 선택하면서도 버튼 활성화 조건, 라운드 로그, 종료 메시지가 선택된 모드를 정확히 반영하길 기대한다.

**Why this priority**: 모드가 늘어나면 사용자 혼선을 막는 명확한 라벨과 상태 관리는 필수이며, 재시작 루프가 안정적으로 유지돼야 한다.

**Independent Test**: 동일 브라우저 세션에서 기존 `승자 뽑기` → `승자 2명 뽑기` → `패자 뽑기` → `패자 2명 뽑기` 순으로 실행하며 버튼 상태, 결과 팝업 메시지, 콘솔 로그 문구가 선택된 모드와 일치하는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 게임 종료 후 다른 모드를 선택하려고 할 때, **When** 라운드가 리셋되면, **Then** 버튼 활성화 조건과 대기열/히스토리 초기화가 모든 모드에서 동일하게 재적용된다.
2. **Given** 각 모드가 시작될 때, **When** 첫 번째 라운드 로그가 콘솔에 기록되면, **Then** 로그 메시지에는 현재 모드 종류(예: `승자 2명 뽑기`)가 포함되어 사용자가 진행 방식을 혼동하지 않는다.

---

### Edge Cases

- 참가자 수가 정확히 2명인 상태에서 `승자 2명 뽑기` 또는 `패자 2명 뽑기`를 선택하면 즉시 종료 메시지를 띄우고 추가 라운드를 생성하지 않는다.
- 듀얼 모드에서 라운드 결과가 목표 인원보다 적은 참가자만 남기면, 직전 라운드 생존자만 대상으로 서든데스 라운드가 연속해서 진행된다.
- 서든데스 진입 직전에는 “1인이 결정되었지만 다른 1인을 뽑는 서든데스가 이어진다”는 안내 팝업을 3초간 띄운 뒤 서든데스 라운드를 시작한다.
- 서든데스 내려가기 전 라운드에서 무승부가 발생하면 동일한 후보군으로 서든데스/재경기가 반복되며, UI 테마와 히스토리 표시는 서든데스 상태(예: 붉은 테두리)를 유지한다.
- 서든데스에서 최종 참가자가 결정되면 일반 라운드에서 이미 확정된 참가자와 합쳐 두 명을 최종 결과로 표시하고 즉시 종료한다. 확정된 참가자는 서든데스 진행 동안 대기열이 아닌 “승자/패자: {이름}” 라벨로 표시된다.
- 재시작하거나 모드를 전환할 때 서든데스 가시 요소(테마, 버튼 강조, 안내 팝업 등)는 즉시 초기화되어 잔존하지 않는다.
- 자동 진행 중 브라우저 탭 전환이나 일시정지로 인해 타이밍이 지연되더라도 서든데스 상태 플래그가 중복으로 유지되지 않고 단일 라운드로만 계산된다.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: UI MUST expose 두 개의 신규 시작 버튼(라벨: `승자 2명 뽑기`, `패자 2명 뽑기`)을 기존 시작 버튼과 동일한 유효성 규칙(참가자 2~12명, 공백 제거 후 중복 허용 여부 유지)에 따라 활성화/비활성화한다.
- **FR-002**: `승자 2명 뽑기` 모드에서 라운드 결과로 두 명의 승자가 동시에 확정되면 즉시 종료하고, 단 한 명만 확정될 경우 해당 승자를 “승자: {이름}”으로 표시한 뒤 서든데스 안내 팝업을 3초간 노출하고 서든데스 라운드를 진행한다.
- **FR-003**: `패자 2명 뽑기` 모드에서 라운드 결과로 두 명의 패자가 동시에 확정되면 즉시 종료하고, 단 한 명만 확정될 경우 해당 패자를 “패자: {이름}”으로 표시한 뒤 서든데스 안내 팝업을 3초간 노출하고 서든데스를 진행한다.
- **FR-004**: 서든데스에 진입할 때는 안내 팝업을 3초간 표시하고, 서든데스 라운드는 카운트다운이 3초로 고정되며 히스토리 카드가 붉은 테두리 등으로 일반 라운드와 명확히 구분되어야 한다.
- **FR-005**: 서든데스 참가자는 직전 라운드 참가자 중 이미 확정된 승자/패자를 제외한 나머지로 구성하며, 서든데스 종료 시 일반 라운드에서 확정된 참가자와 함께 두 명을 최종 결과로 팝업·콘솔에 노출한다.
- **FR-006**: 신규 모드를 연속해서 실행하거나 기존 모드와 교차 실행할 때, 내부 게임 상태는 선택된 모드 식별자와 현재 활성 참가자 수를 항상 동기화해 서든데스 진입/종료가 중복되거나 누락되지 않도록 한다.
- **FR-007**: 콘솔 로그 MUST 한국어로 신규 모드 시작, 라운드별 남은 인원과 목표 인원, 서든데스 진입/진행/종료, 최종 두 명 리스트를 모두 기록하며, 테스트 담당자가 리뷰할 수 있도록 라운드 번호를 포함한다.
- **FR-008**: 히스토리 패널 카드는 신규 모드에서 라운드가 진행될 때 남은 인원 수와 목표(예: "남은 우승 후보 4명, 목표 2명")를 시각적으로 구분하고, 서든데스 라운드는 붉은 테두리 등으로 일반 라운드와 구별해야 한다. 헤더에는 `라운드 N`과 확률(%)을 한 줄에서 좌우로 배치한다.
- **FR-009**: 듀얼 모드에서 라운드 종료 후 두 명을 초과하는 참가자가 동일 조건으로 남으면, 해당 인원만 대상으로 서든데스 라운드를 반복해 정확히 두 명이 될 때까지 이어간다.
- **FR-010**: 듀얼 모드에서 남은 인원이 목표보다 적을 때는 최종 1인을 즉시 확정하지 않고 직전 라운드 생존자만 대상으로 서든데스를 구성하며, 기존 대기열·버튼 상태는 서든데스 종료까지 그대로 잠근다.
- **FR-011**: 서든데스가 시작될 때 UI MUST 테마(배경색, 헤더, 버튼 강조 등)를 전환해 사용자에게 서든데스 상태임을 알리고, 서든데스가 끝나면 즉시 원래 테마로 복귀한다.
- **FR-012**: 서든데스 라운드의 카운트다운은 항상 3초로 고정하며, 기존 라운드 단계(카운트다운, 선택 공개, 대기 시간) 흐름을 유지한다.
- **FR-013**: 서든데스 라운드 이력은 히스토리 카드의 테두리 색 또는 배경 강조로 일반 라운드와 구분되며, 카드 헤더에 남은 인원·목표 인원 정보를 노출한다.
- **FR-016**: 확정된 참가자는 대기 패널에서 “승자: {이름}” 또는 “패자: {이름}” 라벨로 별도 표시하고, 서든데스가 진행되는 동안 일반 대기자 목록에 섞이지 않는다.
- **FR-014**: 서든데스에서 최종 1인이 결정되면, 앞선 라운드에서 확정된 참가자와 함께 최종 2인을 팝업·콘솔에 즉시 노출하고, 게임 상태를 종료된 것으로 표시한다.
- **FR-015**: 서든데스에 진입하기 직전에는 “1인이 결정되었지만 다른 1인을 뽑는 서든데스 모드가 이어진다”는 팝업을 반드시 띄운 뒤 서든데스 카운트다운을 시작한다.

### Assumptions

- 기존 참가자 입력 검증(공백 제거, 빈 값 방지)은 재사용되며 새로운 모드를 위해 추가 필드는 요구되지 않는다.
- 종료 팝업 컴포넌트는 다중 이름을 세로 또는 쉼표 구분으로 표시할 수 있도록 확장 가능하다고 간주한다.
- 두 명이 동시에 제외되어 목표 인원을 넘어설 가능성은 라운드 재연산 또는 우선순위 규칙으로 해결할 수 있다고 가정한다.

### Key Entities *(include if feature involves data)*

- **Participant**: 이름, 현재 상태(활성/대기), 소속 그룹(승자/패자) 플래그. 종료 조건 계산 시 사용된다.
- **Game Mode**: 모드명(승자, 패자, 승자 2명, 패자 2명), 목표 남은 인원(1 또는 2), 라운드별 제외 규칙.
- **Round Result**: 참가자별 선택, 라운드 결과 그룹(승자/패자), 남은 인원 수, 히스토리 카드 문구.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: QA가 Chrome·Firefox 각 3회씩 `승자 2명 뽑기`/`패자 2명 뽑기`를 실행했을 때, 종료 팝업이 두 명의 이름을 포함하고 로직이 2명에서 멈추는 비율이 100%다.
- **SC-002**: 신규 모드 실행 중 각 라운드 콘솔 로그에 남은 인원 수, 목표 인원, 서든데스 진입/종료 메시지가 모두 기록되어 수동 검증자가 라운드당 1회 이상 확인할 수 있다.
- **SC-003**: 서든데스 라운드가 진행되는 세션에서도 입력부터 최종 팝업 표시까지의 시간이 150초를 넘지 않는다(참가자 8명 기준).
- **SC-004**: 수동 체크리스트에서 기존 단일 최종자 모드와 신규 2인 최종자 모드를 연속 실행했을 때 상태 초기화, 버튼 강조, 테마 전환, 히스토리 강조 오류가 0건으로 보고된다.
- **SC-005**: QA가 서든데스 시나리오 3회 이상을 반복했을 때, 히스토리 카드는 모두 서든데스 스타일로 표시되고 카운트다운은 항상 3초로 확인된다.
