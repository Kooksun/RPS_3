# Feature Specification: Dual Finalist Selection Modes

**Feature Branch**: `[001-add-dual-selection]`  
**Created**: 2025-10-28  
**Status**: Draft  
**Input**: User description: "현재 구현상태는 유지한다. 게임 시작 방법이 승자 뽑기, 패자 뽑기 인데, 여기에 승자 2명 뽑기, 패자 2명 뽑기를 추가한다. 라운드에서 승자/패자를 제외하는 것은 동일하지만, 게임의 종료조건이 조금 달라서, 최종 1인이 아닌 최종 2인이 남았을 때 종료되는 모드이다."

## Clarifications

### Session 2025-10-28

- Q: How should dual-finalist modes resolve cases where a round leaves more than two tied survivors? → A: Re-run sudden-death rounds only between the tied survivors until exactly two remain.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Identify the top two winners (Priority: P1)

대회 진행자는 8명의 참가자를 등록한 뒤 `승자 2명 뽑기` 모드를 선택해 자동 시뮬레이션을 돌리고, 최종 두 명의 우승자가 동시에 발표되기를 원한다.

**Why this priority**: 새로운 모드의 핵심 가치가 두 명의 우승자를 빠르게 확보하는 것이므로, 기본 플로우가 안정적이어야 전체 기능이 성립한다.

**Independent Test**: Launch `index.html`, 6~10명의 이름을 입력하고 `승자 2명 뽑기` 버튼을 눌러 라운드를 끝까지 진행한 뒤 UI와 한국어 콘솔 로그가 두 명의 최종 우승자를 동일하게 가리키는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 참가자 수가 4명 이상이고 `승자 2명 뽑기` 버튼이 활성화된 상태, **When** 사용자가 해당 버튼을 클릭하면, **Then** 게임은 기존 자동 라운드 흐름을 사용하되 승자 그룹이 제외돼 2명만 남을 때 즉시 종료된다.
2. **Given** 게임이 `승자 2명 뽑기` 모드에서 종료되었을 때, **When** 최종 결과 팝업과 콘솔 요약이 표시되면, **Then** 두 명의 이름이 동일한 순서로 표기되고 추가 라운드가 더는 시작되지 않는다.

---

### User Story 2 - Surface the bottom two losers (Priority: P2)

교육 담당자는 성과가 낮은 두 명을 가려내기 위해 `패자 2명 뽑기` 모드를 실행하고, 라운드마다 패자만 잔류하도록 하여 마지막에 두 명의 최종 패자를 받는다.

**Why this priority**: 패자 추적 워크플로우도 동일하게 지원되어야 조직 운영자가 원하는 페널티 대상 선정을 빠르게 수행할 수 있다.

**Independent Test**: Manual browser run with 6명 이상의 참가자를 입력한 뒤 `패자 2명 뽑기`를 눌러 전체 라운드를 관찰하고, 마지막에 남은 두 명이 UI/콘솔에서 패자라고 명시되는지 검증한다.

**Acceptance Scenarios**:

1. **Given** 게임이 `패자 2명 뽑기` 모드에서 진행 중이고 라운드가 종료되었다면, **When** 패자 목록이 갱신되면, **Then** 패자만 게임 패널에 남고 승자는 대기열로 이동하며 2명이 되면 자동으로 게임이 멈춘다.
2. **Given** 최종 종료 시점, **When** 시스템이 결과를 알릴 때, **Then** 두 명의 최종 패자가 팝업·콘솔 모두에서 명시되고 재시작 버튼만 활성화된다.

---

### User Story 3 - Maintain mode clarity across selections (Priority: P3)

운영자는 같은 세션에서 단일 최종자 모드와 2인 최종자 모드를 번갈아 선택하면서도 버튼 활성화 조건, 라운드 로그, 종료 메시지가 선택된 모드를 정확히 반영하길 기대한다.

**Why this priority**: 모드가 늘어나면 사용자 혼선을 막는 명확한 라벨과 상태 관리는 필수이며, 재시작 루프가 안정적으로 유지돼야 한다.

**Independent Test**: 동일 브라우저 세션에서 기존 `승자 뽑기` → `승자 2명 뽑기` → `패자 뽑기` → `패자 2명 뽑기` 순으로 실행하며 버튼 상태, 결과 팝업 메시지, 콘솔 로그 문구가 선택된 모드와 일치하는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 게임 종료 후 다른 모드를 선택하려고 할 때, **When** 라운드가 리셋되면, **Then** 버튼 활성화 조건과 대기열/히스토리 초기화가 모든 모드에서 동일하게 재적용된다.
2. **Given** 각 모드가 시작될 때, **When** 첫 번째 라운드 로그가 콘솔에 기록되면, **Then** 로그 메시지에는 현재 모드 종류(예: `승자 2명 뽑기`)가 포함되어 사용자가 진행 방식을 혼동하지 않는다.

---

### Edge Cases

- 참가자 수가 정확히 2명인 상태에서 `승자 2명 뽑기` 또는 `패자 2명 뽑기`를 선택하면 즉시 종료 메시지를 띄우고 추가 라운드를 생성하지 않는다.
- 라운드에서 한 번에 여러 명이 제외되어 2명 미만이 남을 위험이 있을 때, 제외 순서를 조정하거나 즉시 종료해 결과가 정확히 2명으로 고정된다.
- 듀얼 최종자 모드에서 라운드가 끝났는데 3명 이상이 동일 조건으로 남았다면, 해당 참가자들만 sudden-death 라운드를 반복해 2명이 될 때까지 이어간다.
- 재시작하기 전에 참가자 명단을 수정하고 모드를 바꿀 경우, 이전 라운드의 히스토리·대기열이 잔존하지 않아야 한다.
- 무승부가 반복되어 라운드 수가 늘어나도 종료 조건 감시 로직이 누락되지 않는다.
- 자동 진행 중 브라우저 탭 전환이나 일시정지로 인해 타이밍이 지연되더라도 최종 2명 판정이 중복으로 실행되지 않는다.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: UI MUST expose 두 개의 신규 시작 버튼(라벨: `승자 2명 뽑기`, `패자 2명 뽑기`)을 기존 시작 버튼과 동일한 유효성 규칙(참가자 2~12명, 공백 제거 후 중복 허용 여부 유지)에 따라 활성화/비활성화한다.
- **FR-002**: `승자 2명 뽑기` 모드에서 각 라운드 종료 시 승자 그룹을 대기열로 이동시키고 패자만 게임 패널에 남겨, 활성 참가자가 정확히 2명 남는 즉시 자동 진행을 중단한다.
- **FR-003**: `패자 2명 뽑기` 모드에서 각 라운드 종료 시 패자 그룹을 게임 패널에 유지하고 승자를 대기열로 이동시켜, 활성 참가자가 2명이 되면 자동 진행을 멈추고 두 사람을 최종 패자로 선언한다.
- **FR-004**: 두 신규 모드 모두 종료 순간에 팝업·히스토리·대기열·콘솔 로그가 일관되게 두 명의 최종 대상(우승자 또는 패자)을 나열하고, 단일 최종자 모드와 구분되는 문구를 사용해야 한다.
- **FR-005**: 종료 조건에 도달했을 때 UI MUST 비활성화 상태와 재시작 버튼 제공 로직을 재사용하면서도 추가 라운드를 예약하지 않고 카운트다운을 재생성하지 않는다.
- **FR-006**: 신규 모드를 연속해서 실행하거나 기존 모드와 교차 실행할 때, 내부 게임 상태는 선택된 모드 식별자와 현재 활성 참가자 수를 항상 동기화해 중복 종료 이벤트를 방지한다.
- **FR-007**: 콘솔 로그 MUST 한국어로 신규 모드 시작, 각 라운드의 남은 인원 수, 종료 시점의 두 명 리스트를 명시하며, 테스트 담당자가 리뷰할 수 있도록 라운드 번호를 포함한다.
- **FR-008**: 히스토리 패널 카드는 신규 모드에서 라운드가 진행될 때 남은 인원 수와 목표(예: "남은 우승 후보 4명, 목표 2명")를 시각적으로 구분해 관찰자가 진행 상황을 추적할 수 있게 한다.
- **FR-009**: 듀얼 최종자 모드에서 라운드 종료 후 두 명을 초과하는 참가자가 동일 조건으로 남으면, 시스템은 해당 인원만 대상으로 sudden-death 라운드를 반복해 정확히 두 명이 될 때까지 이어가야 한다.

### Assumptions

- 기존 참가자 입력 검증(공백 제거, 빈 값 방지)은 재사용되며 새로운 모드를 위해 추가 필드는 요구되지 않는다.
- 종료 팝업 컴포넌트는 다중 이름을 세로 또는 쉼표 구분으로 표시할 수 있도록 확장 가능하다고 간주한다.
- 두 명이 동시에 제외되어 목표 인원을 넘어설 가능성은 라운드 재연산 또는 우선순위 규칙으로 해결할 수 있다고 가정한다.

### Key Entities *(include if feature involves data)*

- **Participant**: 이름, 현재 상태(활성/대기), 소속 그룹(승자/패자) 플래그. 종료 조건 계산 시 사용된다.
- **Game Mode**: 모드명(승자, 패자, 승자 2명, 패자 2명), 목표 남은 인원(1 또는 2), 라운드별 제외 규칙.
- **Round Result**: 참가자별 선택, 라운드 결과 그룹(승자/패자), 남은 인원 수, 히스토리 카드 문구.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: QA가 Chrome·Firefox 각 3회씩 `승자 2명 뽑기`/`패자 2명 뽑기`를 실행했을 때, 종료 팝업이 두 명의 이름을 포함하고 로직이 2명에서 멈추는 비율이 100%다.
- **SC-002**: 신규 모드 실행 중 각 라운드 콘솔 로그에 남은 인원 수와 목표 인원이 모두 기록되어 수동 검증자가 라운드당 1회 이상 확인할 수 있다.
- **SC-003**: 두 신규 모드 실행 시간(참가자 8명 기준)이 입력부터 종료 팝업 표시까지 120초를 넘지 않는다.
- **SC-004**: 수동 체크리스트에서 기존 단일 최종자 모드와 신규 2인 최종자 모드를 연속 실행했을 때 상태 초기화/버튼 상태 오류가 0건으로 보고된다.
